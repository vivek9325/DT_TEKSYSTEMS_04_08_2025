{"version":19,"variables":[{"key":"status","visible":true,"type":"query","version":1,"editable":true,"input":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR LD '[' HTTPDATE ']' LD 'HTTP/' LD SPACE INT:status LD\"\n| dedup status\n| fields status","multiple":true,"defaultValue":["3420b2ac-f1cf-4b24-b62d-61ba1ba8ed05*"]}],"tiles":{"0":{"type":"markdown","content":"# **Apache Logs**\n--- \n[Apache logs](https://httpd.apache.org/docs/2.4/logs.html) are records maintained by the Apache HTTP Server to capture details about client requests, server activity, and errors. They are essential for monitoring performance, diagnosing issues, and enhancing security. The two most common ~~types~~ are access logs and error logs. Access logs record every incoming HTTP request, typically stored in `/var/log/apache2/access.log` on Debian/Ubuntu or `/var/log/httpd/access_log` on RHEL/CentOS systems. They often use the Common or Combined Log Format, which includes information such as the client IP address, user identity, timestamp, HTTP method, requested resource, protocol version, status code, and response size. The Combined Log Format also logs the referer and user-agent details. Error logs, found in /var/log/apache2/error.log or `/var/log/httpd/error_log`, store server-related error messages, warnings, and startup/shutdown events. Each entry usually contains the timestamp, module and severity level, process ID, client information, and a descriptive error message. Beyond these, Apache may also produce specialized logs such as mod_security audit logs, virtual host-specific logs, or custom logs defined through configuration directives like CustomLog and ErrorLog. Administrators often use commands such as tail -f to monitor logs in real time, grep to search for specific errors, or awk to analyze request patterns by IP. Together, these logs form a vital part of web server management, enabling proactive issue detection and detailed forensic analysis."},"1":{"type":"data","title":"Error By Client IP","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE ']' LD 'HTTP/' LD SPACE INT:status LD\"\n| summarize numOf200Errors=countIf(status==200), \nnumOf404Errors=countIf(status==404), numOf301Errors=countIf(status==301), numOf206Errors=countIf(status==206), numOf403Errors=countIf(status==403), by:{clientip}\n| limit 10","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"autoSelectVisualization":true,"table":{"columnTypeOverrides":[],"columnOrder":["[\"clientip\"]","[\"numOf200Errors\"]","[\"numOf404Errors\"]","[\"numOf301Errors\"]","[\"numOf206Errors\"]","[\"numOf403Errors\"]"]}},"visualization":"table","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-7d","to":"now()"}},"description":"The \"Error By Client IP\" panel shows the distribution of error events grouped by the originating client IP address. It helps identify which clients are generating the most errors, making it easier to troubleshoot recurring issues, detect misconfigured systems, or flag potentially malicious activity."},"2":{"type":"data","title":"Count By Client IP","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE ']' LD 'HTTP/' LD SPACE INT LD\"\n| summarize total_count=count(), by:{clientip}\n| sort - total_count\n| limit 10","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"autoSelectVisualization":false,"thresholds":[],"table":{"columnTypeOverrides":[]},"chartSettings":{"colorPalette":"blue-moss"}},"visualization":"pieChart","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-7d","to":"now()"}}},"3":{"type":"data","title":"Top 10 client ip by referer domain","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE ']' LD 'HTTP/' LD SPACE INT:status SPACE INT LD:url SPACE\"\n| parse url,\"LD:referer_domain'.com'\"\n| fieldsAdd new_referer_domain = concat(\"http://\",referer_domain,\".com\")\n| filterOut new_referer_domain==\"http://.com\"\n| summarize total_count=countIf(status==404), by:{clientip,referer_domain}\n| parse referer_domain, \"LD '/' LD:referer_domain\"\n| fieldsAdd referer_domain=concat(\"http:/\",referer_domain,\".com\")\n| fields clientip, referer_domain, total_count\n| sort - total_count| limit 10","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"autoSelectVisualization":false,"thresholds":[],"table":{"columnTypeOverrides":[],"columnOrder":["[\"clientip\"]","[\"referer_domain\"]","[\"total_count\"]"],"sortBy":[{"columnId":"[\"total_count\"]","direction":"descending"}],"columnWidths":{"[\"total_count\"]":272,"[\"referer_domain\"]":270,"[\"clientip\"]":172}}},"visualization":"table","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-7d","to":"now()"}}},"4":{"type":"data","title":"","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE ']' LD 'HTTP/' LD SPACE INT:status SPACE INT LD:url\"\n| parse url, \"LD SPACE LD:useragent\"\n| parse useragent, \"DQS:useragent\"\n| filter in(status,Array($status:noquote))\n| summarize total_count=count(), by:{clientip,useragent}\n| filterOut useragent==\"-\"\n| sort - total_count\n| filter isNotNull(useragent)\n| limit 10","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"autoSelectVisualization":false,"thresholds":[],"table":{"columnTypeOverrides":[]},"chartSettings":{"categoricalBarChartSettings":{"layout":"horizontal","isValueLabelVisible":true,"isCategoryLabelVisible":true,"categoryAxisLabel":"User Agent","valueAxisLabel":"Total Count","valueAxisScale":"linear","scale":"absolute","groupMode":"stacked","tooltipVariant":"single"},"legend":{"position":"auto"},"truncationMode":"middle","colorPalette":"blue"}},"visualization":"categoricalBarChart","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-7d","to":"now()"}}},"5":{"type":"data","title":"","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE ']' LD:url 'HTTP/' LD SPACE INT:status SPACE LD\"\n| parse url, \"LD SPACE LD:url\"\n| filter status==404\n| summarize occurences=count() ,by:{url}\n| fieldsRename result=url\n|fieldsAdd type=\"Top 404 URLS\"\n| fields type, result, occurences\n| sort - occurences\n| limit 10","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"autoSelectVisualization":true,"table":{"columnTypeOverrides":[],"columnOrder":["[\"type\"]","[\"result\"]","[\"occurences\"]"],"columnWidths":{"[\"result\"]":460,"[\"type\"]":133,"[\"occurences\"]":101}}},"visualization":"table","querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"timeframe":{"tileTimeframeEnabled":true,"tileTimeframe":{"from":"now()-7d","to":"now()"}}}},"layouts":{"0":{"x":0,"y":0,"w":23,"h":4},"1":{"x":0,"y":4,"w":10,"h":6},"2":{"x":10,"y":4,"w":10,"h":6},"3":{"x":0,"y":19,"w":10,"h":6},"4":{"x":0,"y":10,"w":20,"h":9},"5":{"x":10,"y":19,"w":10,"h":6}},"importedWithCode":false,"settings":{"defaultTimeframe":{"value":{"from":"now()-7d","to":"now()"},"enabled":true}}}