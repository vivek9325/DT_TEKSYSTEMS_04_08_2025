{"version":"7","defaultTimeframe":{"from":"now()-2h","to":"now()"},"defaultSegments":[],"sections":[{"id":"1a32ba07-8c4e-40f0-b81b-aff9b3dab0c0","type":"markdown","markdown":"Apache logs are records maintained by the Apache HTTP Server to capture details about client requests, server activity, and errors. They are essential for monitoring performance, diagnosing issues, and enhancing security. The two most common types are access logs and error logs. Access logs record every incoming HTTP request, typically stored in /var/log/apache2/access.log on Debian/Ubuntu or /var/log/httpd/access_log on RHEL/CentOS systems. They often use the Common or Combined Log Format, which includes information such as the client IP address, user identity, timestamp, HTTP method, requested resource, protocol version, status code, and response size. The Combined Log Format also logs the referer and user-agent details. Error logs, found in /var/log/apache2/error.log or /var/log/httpd/error_log, store server-related error messages, warnings, and startup/shutdown events. Each entry usually contains the timestamp, module and severity level, process ID, client information, and a descriptive error message. Beyond these, Apache may also produce specialized logs such as mod_security audit logs, virtual host-specific logs, or custom logs defined through configuration directives like CustomLog and ErrorLog. Administrators often use commands such as tail -f to monitor logs in real time, grep to search for specific errors, or awk to analyze request patterns by IP. Together, these logs form a vital part of web server management, enabling proactive issue detection and detailed forensic analysis."},{"id":"c158cd34-5939-4a9b-9137-a28a018abf60","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":278,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n//| filter in (status, Array($Status:noquote))\n//| filter status==$Status:noquote\n|summarize total_count=count() ,by:{clientip}\n| sort - total_count\n| limit 10"},"visualizationSettings":{"thresholds":[],"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"pieChart","result":{"code":200,"value":{"records":[{"clientip":"66.249.73.135","total_count":"482"},{"clientip":"46.105.14.53","total_count":"364"},{"clientip":"130.237.218.86","total_count":"357"},{"clientip":"75.97.9.59","total_count":"273"},{"clientip":"50.16.19.13","total_count":"113"},{"clientip":"209.85.238.199","total_count":"102"},{"clientip":"68.180.224.225","total_count":"99"},{"clientip":"100.43.83.137","total_count":"84"},{"clientip":"208.115.111.72","total_count":"83"},{"clientip":"198.46.149.143","total_count":"82"}],"types":[{"indexRange":[0,9],"mappings":{"clientip":{"type":"ip_address"},"total_count":{"type":"long"}}}],"metadata":{"grail":{"canonicalQuery":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n| summarize by:{clientip}, total_count = count()\n| sort -total_count\n| limit 10","timezone":"Asia/Calcutta","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n//| filter in (status, Array($Status:noquote))\n//| filter status==$Status:noquote\n|summarize total_count=count() ,by:{clientip}\n| sort - total_count\n| limit 10","scannedRecords":13809,"dqlVersion":"V1_0","scannedBytes":5007043,"scannedDataPoints":0,"analysisTimeframe":{"start":"2025-08-12T13:18:07.842000000Z","end":"2025-08-12T15:18:07.842000000Z"},"locale":"en-US","executionTimeMilliseconds":40,"notifications":[],"queryId":"0d2e0724-caac-4196-a44b-9480d252dd6b","sampled":false}}},"notifications":[],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2025-08-12T15:18:08.932Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n//| filter in (status, Array($Status:noquote))\n//| filter status==$Status:noquote\n|summarize total_count=count() ,by:{clientip}\n| sort - total_count\n| limit 10"}},"state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}}}},{"id":"92f7e417-0643-4281-a5c5-84598c4f70e8","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":284,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status SPACE INT SPACE LD:URL\"\n| parse URL, \"LD:referer_domain SPACE\"\n| parse referer_domain, \"DQS:referer_domain\"\n| parse referer_domain, \"'http://'LDATA:referer_dom'.com'\"\n| fieldsAdd referer_dom = concat(\"http://\",referer_dom,\".com\")\n| filterOut referer_dom==\"http://.com\"\n| summarize error_404_count=countIf(status==404), by:{clientip,referer_dom} \n| sort - error_404_count\n| limit 10"},"visualizationSettings":{"thresholds":[],"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table","result":{"code":200,"value":{"records":[{"clientip":"75.97.9.59","referer_dom":"http://semicomplete.com","error_404_count":"6"},{"clientip":"176.92.75.62","referer_dom":"http://www.semicomplete.com","error_404_count":"5"},{"clientip":"130.237.218.86","referer_dom":"http://semicomplete.com","error_404_count":"4"},{"clientip":"78.173.140.106","referer_dom":"http://www.semicomplete.com","error_404_count":"3"},{"clientip":"89.107.177.18","referer_dom":"http://semicomplete.com","error_404_count":"2"},{"clientip":"111.199.235.239","referer_dom":"http://semicomplete.com","error_404_count":"2"},{"clientip":"122.166.142.108","referer_dom":"http://semicomplete.com","error_404_count":"2"},{"clientip":"193.244.33.47","referer_dom":"http://semicomplete.com","error_404_count":"2"},{"clientip":"204.62.56.3","referer_dom":"http://semicomplete.com","error_404_count":"2"},{"clientip":"219.64.34.68","referer_dom":"http://semicomplete.com","error_404_count":"2"}],"types":[{"indexRange":[0,9],"mappings":{"clientip":{"type":"ip_address"},"referer_dom":{"type":"string"},"error_404_count":{"type":"long"}}}],"metadata":{"grail":{"canonicalQuery":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status SPACE INT SPACE LD:URL\"\n| parse URL, \"LD:referer_domain SPACE\"\n| parse referer_domain, \"DQS:referer_domain\"\n| parse referer_domain, \"'http://'LDATA:referer_dom'.com'\"\n| fieldsAdd referer_dom = concat(\"http://\", referer_dom, \".com\")\n| filterOut referer_dom == \"http://.com\"\n| summarize by:{clientip, referer_dom}, error_404_count = countIf(status == 404)\n| sort -error_404_count\n| limit 10","timezone":"Asia/Calcutta","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status SPACE INT SPACE LD:URL\"\n| parse URL, \"LD:referer_domain SPACE\"\n| parse referer_domain, \"DQS:referer_domain\"\n| parse referer_domain, \"'http://'LDATA:referer_dom'.com'\"\n| fieldsAdd referer_dom = concat(\"http://\",referer_dom,\".com\")\n| filterOut referer_dom==\"http://.com\"\n| summarize error_404_count=countIf(status==404), by:{clientip,referer_dom} \n| sort - error_404_count\n| limit 10","scannedRecords":13812,"dqlVersion":"V1_0","scannedBytes":5007092,"scannedDataPoints":0,"analysisTimeframe":{"start":"2025-08-12T13:18:34.025000000Z","end":"2025-08-12T15:18:34.025000000Z"},"locale":"en-US","executionTimeMilliseconds":58,"notifications":[],"queryId":"d0b32d71-6bc3-49ea-aac8-d7bd529fd48e","sampled":false}}},"notifications":[],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2025-08-12T15:18:35.017Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status SPACE INT SPACE LD:URL\"\n| parse URL, \"LD:referer_domain SPACE\"\n| parse referer_domain, \"DQS:referer_domain\"\n| parse referer_domain, \"'http://'LDATA:referer_dom'.com'\"\n| fieldsAdd referer_dom = concat(\"http://\",referer_dom,\".com\")\n| filterOut referer_dom==\"http://.com\"\n| summarize error_404_count=countIf(status==404), by:{clientip,referer_dom} \n| sort - error_404_count\n| limit 10"}},"state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}}}},{"id":"d978ef5d-46a1-43d2-af8b-d6a821501371","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n|summarize numOf200Errors=countIf(status==200), numOf404Errors=countIf(status==404), numOf301Errors=countIf(status==301),\nnumOf206Errors=countIf(status==206), numOf403Errors=countIf(status==403) ,by:{clientip}\n| limit 10"},"visualizationSettings":{"thresholds":[],"chartSettings":{"categoricalBarChartSettings":{"layout":"vertical"}}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"categoricalBarChart","result":{"code":200,"value":{"records":[{"clientip":"1.22.35.226","numOf200Errors":"6","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.38.110.208","numOf200Errors":"1","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.51.241.128","numOf200Errors":"2","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.85.194.19","numOf200Errors":"1","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.137.32.153","numOf200Errors":"6","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.179.147.248","numOf200Errors":"1","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"2.241.35.167","numOf200Errors":"29","numOf404Errors":"0","numOf301Errors":"3","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"5.0.46.207","numOf200Errors":"1","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"5.9.143.150","numOf200Errors":"0","numOf404Errors":"1","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"},{"clientip":"5.10.83.21","numOf200Errors":"4","numOf404Errors":"0","numOf301Errors":"0","numOf206Errors":"0","numOf403Errors":"0"}],"types":[{"indexRange":[0,9],"mappings":{"clientip":{"type":"ip_address"},"numOf200Errors":{"type":"long"},"numOf404Errors":{"type":"long"},"numOf301Errors":{"type":"long"},"numOf206Errors":{"type":"long"},"numOf403Errors":{"type":"long"}}}],"metadata":{"grail":{"canonicalQuery":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n| summarize by:{clientip}, {numOf200Errors = countIf(status == 200), numOf404Errors = countIf(status == 404), numOf301Errors = countIf(status == 301), numOf206Errors = countIf(status == 206), numOf403Errors = countIf(status == 403)}\n| limit 10","timezone":"Asia/Calcutta","query":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n|summarize numOf200Errors=countIf(status==200), numOf404Errors=countIf(status==404), numOf301Errors=countIf(status==301),\nnumOf206Errors=countIf(status==206), numOf403Errors=countIf(status==403) ,by:{clientip}\n| limit 10","scannedRecords":13916,"dqlVersion":"V1_0","scannedBytes":5008905,"scannedDataPoints":0,"analysisTimeframe":{"start":"2025-08-12T13:36:18.707000000Z","end":"2025-08-12T15:36:18.708000000Z"},"locale":"en-US","executionTimeMilliseconds":114,"notifications":[{"severity":"INFO","messageFormat":"The parameters should be grouped with curly braces: {}.","syntaxPosition":{"start":{"column":12,"index":168,"line":4},"end":{"column":72,"index":350,"line":5}},"messageFormatSpecifierTypes":[],"arguments":[],"notificationType":"PARAMETERS_SHOULD_BE_GROUPED","message":"The parameters should be grouped with curly braces: {}."}],"queryId":"25f4791a-b38d-4800-86e2-de34a782a4be","sampled":false}}},"notifications":[{"severity":"info","messageFormat":"The parameters should be grouped with curly braces: {}.","syntaxPosition":{"start":{"column":12,"index":168,"line":4},"end":{"column":72,"index":350,"line":5}},"messageFormatSpecifierTypes":[],"arguments":[],"notificationType":"PARAMETERS_SHOULD_BE_GROUPED","message":"The parameters should be grouped with curly braces: {}."}],"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"dateTime":"2025-08-12T15:36:21.810Z","input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"fetch logs\n| filter matchesValue(log.source, \"apache.log\")\n| parse content, \"IPADDR:clientip LD '[' HTTPDATE:date ']' LD:url 'HTTP/' LD SPACE INT:status LD\"\n|summarize numOf200Errors=countIf(status==200), numOf404Errors=countIf(status==404), numOf301Errors=countIf(status==301),\nnumOf206Errors=countIf(status==206), numOf403Errors=countIf(status==403) ,by:{clientip}\n| limit 10"}},"state":"success","davis":{"includeLogs":true,"davisVisualization":{"isAvailable":true}}}}]}